<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Nh·∫≠p pass ƒëi ng∆∞·ªùi ƒë·∫πp</title>
<style>
  :root {
    --bg:#f6f7fb; --card:#fff; --text:#111; --muted:#777;
    --accent:#ff6b81; --shadow1: 10px 10px 30px rgba(0,0,0,.08);
    --shadow2: -8px -8px 24px rgba(255,255,255,.9);
    --radius: 22px;
  }
  *{box-sizing:border-box;margin:0;padding:0}
  html,body{
    height:100%;
    width:100%;
    overflow-x:hidden;
    overflow-y:auto; /* Cho ph√©p cu·ªôn */
    background: var(--bg);
  }
  body {
    font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial;
    display:flex;
    justify-content:center;
    align-items:flex-start;
    padding:20px 0;
  }
  h1 { text-align:center; margin:24px 0; font-size: clamp(24px,4vw,42px); }
  .card { background:var(--card); border-radius:var(--radius);
    padding:28px; box-shadow:var(--shadow1),var(--shadow2);
    display:grid; grid-template-columns:1fr 1fr; gap:24px; align-items:center;
    max-width: 90vw;
  }
  .photo { background:#fff; border-radius:18px; padding:12px; position:relative;
    box-shadow: inset 6px 6px 16px rgba(0,0,0,.05), inset -6px -6px 16px rgba(255,255,255,.85);
    display:flex; align-items:center; justify-content:center; aspect-ratio:1/1; overflow:hidden;
  }
  .photo img { width:100%; height:100%; object-fit:cover; border-radius:14px; }
  .photo .hearts { position:absolute; right:10px; bottom:10px; font-size:22px; color:var(--accent) }
  .panel { display:flex; flex-direction:column; gap:14px; }
  .display { background:#fff; border-radius:14px; padding:14px 18px; font-size:22px; letter-spacing:6px;
    text-align:center; box-shadow:inset 6px 6px 14px rgba(0,0,0,.06), inset -6px -6px 18px rgba(255,255,255,.9);
    min-height:54px; user-select:none;
  }
  .keypad { display:grid; grid-template-columns:repeat(3,1fr); gap:14px; }
  .btn { background:#fff; border:0; border-radius:16px; padding:18px; font-size:20px; cursor:pointer;
    box-shadow:var(--shadow1),var(--shadow2); transition:transform .06s ease, box-shadow .12s ease;
  }
  .btn:active { transform:translateY(1px) scale(.99); }
  .btn.alt { background:#f1f2f6 }
  .btn.ok { color:var(--accent); font-weight:700 }
  .hint { text-align:center; color:var(--muted); font-size:14px }
  
  #matrixWrap {
    position:fixed; inset:0; display:none; place-items:center;
    background: #000;
    overflow:hidden;
    touch-action:none;
  }
  video.bg-video {
    position:fixed;
    inset:0;
    width:100%;
    height:100%;
    object-fit:cover;
    background:#000;
    z-index:-1;
    transform-origin:center center;
    transition:transform 0.1s ease-out, opacity 0.3s ease;
    opacity:0; /* ·∫©n khi ch∆∞a load */
  }
  #birthdayCanvas { width:100%; height:100%; display:block; }
  .continue-bar { position:fixed; left:0; right:0; bottom:18px; display:none; justify-content:center; z-index:10; }
  .continue-btn { background:#fff; border:0; padding:12px 18px; border-radius:999px; font-weight:600;
    font-size:16px; box-shadow:var(--shadow1),var(--shadow2); cursor:pointer;
  }
  
  #video2Wrap {
    position:fixed;
    inset:0;
    display:none;
    background:#000;
    z-index:9999;
    flex-direction: column;
    justify-content: center;
    align-items: center;
  }
  #video2Wrap video {
    max-width:100vw;
    max-height:100vh;
    object-fit:contain;
    background:#000;
  }
  .after-video-buttons {
    position:absolute;
    bottom:30px;
    display:flex;
    gap:12px;
    z-index:10000;
  }
  .after-video-buttons button {
    background:#fff; border:0; padding:10px 16px;
    border-radius:8px; font-weight:600; cursor:pointer;
    box-shadow:var(--shadow1),var(--shadow2);
  }
  
  @media (max-width:720px){
    .card{ grid-template-columns:1fr; }
  }
</style>
</head>
<body>

<div class="wrap" id="gateWrap">
  <h1>NH·∫¨P PASS ƒêI NG∆Ø·ªúI ƒê·∫∏P</h1>
  <div class="card">
    <div class="photo">
      <img src="girl.png" alt="Cute girl">
      <div class="hearts">‚ù§Ô∏é ‚ù§Ô∏é</div>
    </div>
    <div class="panel">
      <div class="display" id="display">&nbsp;</div>
      <div class="keypad">
        <button class="btn" data-key="1">1</button>
        <button class="btn" data-key="2">2</button>
        <button class="btn" data-key="3">3</button>
        <button class="btn" data-key="4">4</button>
        <button class="btn" data-key="5">5</button>
        <button class="btn" data-key="6">6</button>
        <button class="btn" data-key="7">7</button>
        <button class="btn" data-key="8">8</button>
        <button class="btn" data-key="9">9</button>
        <button class="btn ok" id="ok">‚úì</button>
        <button class="btn" data-key="0">0</button>
        <button class="btn alt" id="del">‚úï</button>
      </div>
      <div class="hint">G·ª£i √Ω: ng√†y sinh c·ªßa p√© y√™u üòâ</div>
    </div>
  </div>
</div>

<section id="matrixWrap">
  <video id="bgVideo" class="bg-video" preload="auto" playsinline>
    <source src="video.mp4" type="video/mp4">
  </video>
  <canvas id="birthdayCanvas"></canvas>
  <div class="continue-bar" id="continueBar">
    <button class="continue-btn" id="continueBtn">Ti·∫øp t·ª•c ‚ûú</button>
  </div>
</section>

<div id="video2Wrap">
  <video id="video2" autoplay preload="auto" playsinline>
    <source src="video2.mp4" type="video/mp4">
  </video>
  <div class="after-video-buttons" id="afterVideoBtns" style="display:none;">
    <button id="replayBg">Replay n·ªÅn</button>
    <button id="replayVid">Replay video</button>
    <button id="logout">ƒêƒÉng xu·∫•t</button>
  </div>
</div>

<script>
const PASSCODE = "15082006";
let buffer = '';
const display = document.getElementById('display');
const gateWrap = document.getElementById('gateWrap');
const matrixWrap = document.getElementById('matrixWrap');
const bgVideo = document.getElementById('bgVideo');
const video2Wrap = document.getElementById('video2Wrap');
const video2 = document.getElementById('video2');

// ·∫®n video n·ªÅn cho ƒë·∫øn khi load xong frame ƒë·∫ßu
bgVideo.addEventListener('loadeddata', () => {
  bgVideo.style.opacity = "1";
});

// Loop th·ªß c√¥ng ƒë·ªÉ tr√°nh v·ªát tr·∫Øng
bgVideo.addEventListener('ended', () => {
  bgVideo.currentTime = 0;
  bgVideo.play().catch(()=>{});
});

function renderDisplay(){ display.textContent = buffer || '\u00A0'; }

document.querySelector('.keypad').addEventListener('click', e=>{
  const key = e.target.dataset.key;
  if(!key) return;
  if(buffer.length < 12) buffer += key;
  renderDisplay();
});
document.getElementById('del').addEventListener('click', ()=>{
  buffer = buffer.slice(0,-1); renderDisplay();
});
document.getElementById('ok').addEventListener('click', verify);
document.addEventListener('keydown', e=>{
  if(/^[0-9]$/.test(e.key)){ buffer += e.key; renderDisplay(); }
  if(e.key==='Backspace'){ buffer = buffer.slice(0,-1); renderDisplay(); }
  if(e.key==='Enter'){ verify(); }
});

function verify(){
  if(buffer === PASSCODE){
    gateWrap.style.display = 'none';
    matrixWrap.style.display = 'grid';
    bgVideo.currentTime = 0;
    bgVideo.muted = false; // b·∫≠t ti·∫øng
    bgVideo.play().catch(()=>{});
    startBirthdayMatrix({
      canvasId: 'birthdayCanvas',
      onFinished: ()=> document.getElementById('continueBar').style.display = 'flex'
    });
  } else {
    display.style.animation = 'shake .35s'; display.style.color = 'crimson';
    setTimeout(()=>{ display.style.animation=''; display.style.color=''; }, 360);
  }
}

document.getElementById('continueBtn').addEventListener('click', ()=>{
  bgVideo.pause();
  document.getElementById('birthdayCanvas').style.display = 'none';
  matrixWrap.style.display = 'none';
  video2Wrap.style.display = 'flex';
  video2.currentTime = 0;
  video2.play().catch(()=>{});
});

video2.addEventListener('ended', ()=>{
  document.getElementById('afterVideoBtns').style.display = 'flex';
});

document.getElementById('replayBg').addEventListener('click', ()=>{
  video2.pause();
  video2Wrap.style.display = 'none';
  document.getElementById('birthdayCanvas').style.display = 'block';
  matrixWrap.style.display = 'grid';
  document.getElementById('continueBar').style.display = 'none';
  bgVideo.currentTime = 0;
  bgVideo.play().catch(()=>{});
  startBirthdayMatrix({
    canvasId: 'birthdayCanvas',
    onFinished: ()=> document.getElementById('continueBar').style.display = 'flex'
  });
});

document.getElementById('replayVid').addEventListener('click', ()=>{
  document.getElementById('afterVideoBtns').style.display = 'none';
  video2.currentTime = 0;
  video2.play().catch(()=>{});
});

document.getElementById('logout').addEventListener('click', ()=>{
  bgVideo.pause();
  video2.pause();
  video2Wrap.style.display = 'none';
  gateWrap.style.display = 'block';
  buffer = '';
  renderDisplay();
});

/* Zoom & Pan cho mobile */
(function() {
  let scale = 1, lastScale = 1, posX = 0, posY = 0, lastX = 0, lastY = 0;
  let isDragging = false, startX, startY, lastDist = 0;

  function setTransform() {
    bgVideo.style.transform = `translate(${posX}px, ${posY}px) scale(${scale})`;
  }

  bgVideo.addEventListener('touchstart', e => {
    if (e.touches.length === 1) {
      isDragging = true;
      startX = e.touches[0].clientX - lastX;
      startY = e.touches[0].clientY - lastY;
    } else if (e.touches.length === 2) {
      isDragging = false;
      const dx = e.touches[1].clientX - e.touches[0].clientX;
      const dy = e.touches[1].clientY - e.touches[0].clientY;
      lastDist = Math.hypot(dx, dy);
    }
  });

  bgVideo.addEventListener('touchmove', e => {
    e.preventDefault();
    if (e.touches.length === 1 && isDragging) {
      posX = e.touches[0].clientX - startX;
      posY = e.touches[0].clientY - startY;
      lastX = posX; lastY = posY;
      setTransform();
    } else if (e.touches.length === 2) {
      const dx = e.touches[1].clientX - e.touches[0].clientX;
      const dy = e.touches[1].clientY - e.touches[0].clientY;
      const dist = Math.hypot(dx, dy);
      scale = Math.max(1, Math.min(3, lastScale * (dist / lastDist)));
      setTransform();
    }
  }, { passive: false });

  bgVideo.addEventListener('touchend', e => {
    if (e.touches.length === 0) {
      lastScale = scale;
      lastX = posX;
      lastY = posY;
      isDragging = false;
    }
  });
})();
</script>
<script src="birthday-matrix.js"></script>
</body>
</html>
